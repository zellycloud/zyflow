# ZyFlow 향후 개선 정리 (업데이트)

SDD/TDD 기본 방향은 유지하되, 가벼운 규칙과 자동화를 우선한다. 각 섹션에 “바로 할 일”을 붙였다.

## 1) 동기화 신뢰도
- 단일 소스 선언: `tasks.md` ↔ DB 중 무엇을 진실로 둘지 결정하고 충돌 정책(우선순위/타임스탬프/섹션·오더 병합) 문서화.
- 변경 로그/리플레이: watcher 이벤트를 큐에 기록하고 실패 시 재적용 가능하도록 설계.
- 정합성 점검: `tasks.md` ↔ DB diff/헬스체크를 CLI/API로 제공, 주기 실행.
- 동시 수정 보호: 태스크 단위 버전 필드(updated_at 등)로 잃어버린 업데이트 방지.
**바로 할 일**: 진실원칙 결정 → 충돌 정책 초안 작성 → watcher 로그/리플레이 설계 메모 추가.

## 2) 환경 추상화
- 설정 분리: API 베이스 URL/포트, 프로젝트 루트, watcher 옵션을 env/설정 파일로 노출.
- macOS 의존 제거: `osascript`는 선택 사항, 경로 직접 입력/CLI 인자로 대체 경로 제공.
- Docker 여부: 팀 재현성 필요 시에만 도입. 필수는 bind-mount(`openspec` 루트)와 포트 노출. 단일 사용자면 버전 고정(.tool-versions/노드 버전)으로도 충분.
**바로 할 일**: env/설정 스펙 정의 → macOS 의존 옵션화 → Docker 필요성 판단 노트 작성.

## 3) 워크플로우/규칙 경량화
- 미니 SPEC 기준: “3파일 이상” 또는 “아키텍처 영향 중간↑/1시간↑”일 때만 mini-spec, 그 외는 태스크 설명+AC.
- Plan→Run→Sync는 선택형: 기본은 `start → test → done` 3단계, 필요 시 플래그로 확장.
- TDD 게이트: 중요 태스크만 “테스트 통과 시 완료”, 일반 태스크는 경고+체크박스.
**바로 할 일**: mini-spec 트리거 문구 확정 → CLI/API에 `start/test/done` 단축 플로우 명시.

## 4) 자동화 우선순위
- watcher/sync 신뢰도 개선(로그, 리트라이, 정합성 체크)이 최우선.
- 테스트/헬스체크 훅: CLI/API 호출 시 테스트 명령 연결, 실패 요약을 태스크 히스토리에 기록.
- 상태/로그 표준화: API 헬스체크, 동기화 실패율/드리프트 지표 노출.
**바로 할 일**: 헬스 지표 목록 정의 → 실패 요약 저장 위치 결정 → 리트라이 정책 초안.

## 5) 테스트 전략(준비)
- 단위: parser(`tasks.md`), sync 머지 로직, Drizzle CRUD, MCP/CLI 핸들러, 핵심 hooks.
- 통합: “`tasks.md` 수정 → sync → DB → UI” 왕복, “DB 수정 → `tasks.md` 재생성” 각 1~2 케이스.
- 프런트: useChanges/useTasks + Flow UI 최소 상호작용 테스트.
**바로 할 일**: 우선순위 높은 3~5개 단위 테스트 후보 선정 → 첫 통합 시나리오 1개 작성.

## 6) 제품/UX 방향
- 로컬/프라이빗 강점 유지, 규칙은 가볍게, 도구가 지켜주게(자동화·헬스체크 중심).
- 멀티 프로젝트 지원은 경로·환경 설정만으로 가능하게 유지.
- 모아이 ADK의 강제 절차는 참조하되, ZF에서는 선택적/경량 옵션만 채택.
**바로 할 일**: “기본 가벼움 + 선택적 강화” 원칙을 README/설정 가이드에 반영.

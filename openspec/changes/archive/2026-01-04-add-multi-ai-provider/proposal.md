# λ©€ν‹° AI Provider μ§€μ› + μ‹¤ν–‰ λ¨λ“ λ¶„λ¦¬

## Summary

zyflowμ νƒμ¤ν¬ μ‹¤ν–‰ μ‹μ¤ν…μ„ ν™•μ¥ν•μ—¬:
1. **λ‹¤μ¤‘ AI Provider μ§€μ›**: Claude μ™Έμ— Gemini, Codex, Qwen λ“± μ§€μ›
2. **μ‹¤ν–‰ λ¨λ“ λ¶„λ¦¬**: λ‹¨μΌ μ‹¤ν–‰(useAI)κ³Ό Swarm μ‹¤ν–‰(useSwarm)μ„ λ…ν™•ν λ¶„λ¦¬
3. κΈ°μ΅΄ CLI Adapter κµ¬μ΅°λ¥Ό ν™μ©ν•μ—¬ μ¶©λ μ—†μ΄ ν†µν•©

## Motivation

### ν„μ¬ μƒν™©
- **λ‘ κ°μ μ‹¤ν–‰ μ‹μ¤ν… μ΅΄μ¬** (νΌλ€ μ λ°)
  - `useClaude` β†’ `/api/claude/execute` β†’ λ‹¨μΌ νƒμ¤ν¬
  - `useClaudeFlowExecution` β†’ `/api/claude-flow/*` β†’ Swarm λ©€ν‹°μ—μ΄μ „νΈ
- Claude Code CLIλ§ μ§€μ›
- `server/cli-adapter/`μ— μ΄λ―Έ 6κ° AI CLI ν”„λ΅ν•„ μ •μλ¨ (λ―Έμ‚¬μ©)
- λ¨λ“  νƒμ¤ν¬κ°€ Claudeλ΅λ§ μ‹¤ν–‰λμ–΄ λΉ„μ©/μ„±λ¥ μµμ ν™” λ¶κ°€

### λ©ν‘
- **μ‹¤ν–‰ λ¨λ“ μ„ νƒ**: λ‹¨μΌ vs Swarm λ…ν™•ν κµ¬λ¶„
- **λ‹¤μ¤‘ Provider μ§€μ›**: νƒμ¤ν¬ μ‹¤ν–‰ μ‹ AI μ„ νƒ κ°€λ¥
- **κΈ°μ΅΄ κµ¬μ΅° ν™μ©**: CLI Adapter μ¬μ‚¬μ©
- **ν•μ„ νΈν™μ„± μ μ§€**: κΈ°μ΅΄ useClaude μ½”λ“ λ³€κ²½ μ—†μ΄ λ™μ‘

### κΈ°λ€ ν¨κ³Ό
- **λ…ν™•ν• UX**: λ‹¨μΌ/Swarm λ¨λ“ μ„ νƒμΌλ΅ λΉ„μ© μμΈ΅ κ°€λ¥
- **λΉ„μ© μ κ°**: λ‹¨μ νƒμ¤ν¬λ” μ €λ ΄ν• λ¨λΈ μ‚¬μ© (Gemini Flash, Haiku)
- **μ„±λ¥ μµμ ν™”**: λ€μ©λ‰ μ»¨ν…μ¤νΈλ” Gemini Pro ν™μ© (100λ§ ν† ν°)
- **ν™•μ¥μ„±**: μƒ AI CLI μ¶”κ°€ μ©μ΄

## Scope

### In Scope
- **μ‹¤ν–‰ λ¨λ“ μ„ νƒ UI**: λ‹¨μΌ μ‹¤ν–‰ / Swarm μ‹¤ν–‰ νƒ­
- **useAI ν›…**: λ‹¤μ¤‘ Provider μ§€μ› λ‹¨μΌ μ‹¤ν–‰ ν›…
- **useSwarm ν›…**: useClaudeFlowExecution λ¦¬λ„¤μ„ + μ •λ¦¬
- **useClaude ν•μ„ νΈν™**: useAI λνΌλ΅ μ μ§€
- **μ„λ²„ API ν™•μ¥**: `/api/ai/execute` μ—”λ“ν¬μΈνΈ
- **Providerλ³„ λ¨λΈ μµμ…**: λ™μ  λ΅λ“
- **CLI κ°€μ©μ„± μ²΄ν¬**: λ―Έμ„¤μΉ Provider λΉ„ν™μ„±ν™”

### Out of Scope
- MCP Server κΈ°λ° ν†µν•© (λ¬Έμ„ λ°©μ‹)
- νƒμ¤ν¬ μ ν•λ³„ μλ™ λΌμ°ν… (v2)
- Consensus ν¨ν„΄ - λ‹¤μ¤‘ AI ν•©μ (v2)
- Swarmμ— λ‹¤μ¤‘ Provider μ§€μ› (v2)
- μ»¤μ¤ν…€ CLI μ¶”κ°€ UI

## Approach

### μ•„ν‚¤ν…μ² (μµμ… 1: λ¶„λ¦¬ μ μ§€)

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                    TaskExecutionDialog                           β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                                  β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”            β”‚
β”‚  β”‚  β΅ λ‹¨μΌ μ‹¤ν–‰        β”‚    β”‚  π Swarm μ‹¤ν–‰       β”‚            β”‚
β”‚  β”‚  (λΉ λ¥΄κ³  μ €λ ΄)      β”‚    β”‚  (λ©€ν‹°μ—μ΄μ „νΈ)      β”‚            β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”            β”‚
β”‚             β”‚                          β”‚                        β”‚
β”‚             β–Ό                          β–Ό                        β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”            β”‚
β”‚  β”‚ Provider μ„ νƒ        β”‚    β”‚ Strategy μ„ νƒ       β”‚            β”‚
β”‚  β”‚ Claude/Gemini/Codex β”‚    β”‚ Dev/Research/Test   β”‚            β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”            β”‚
β”‚             β”‚                          β”‚                        β”‚
β”‚             β–Ό                          β–Ό                        β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”            β”‚
β”‚  β”‚ Model μ„ νƒ          β”‚    β”‚ Max Agents μ„¤μ •     β”‚            β”‚
β”‚  β”‚ Haiku/Sonnet/Opus   β”‚    β”‚ 1-10                β”‚            β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”            β”‚
β”‚                                                                  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                               β”‚
           β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
           β”‚                                       β”‚
           β–Ό                                       β–Ό
    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”                        β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚   useAI     β”‚                        β”‚  useSwarm   β”‚
    β”‚  (μƒ ν›…)    β”‚                        β”‚ (λ¦¬λ„¤μ„)    β”‚
    β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”                        β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
           β”‚                                       β”‚
           β–Ό                                       β–Ό
    /api/ai/execute                        /api/claude-flow/*
           β”‚                                       β”‚
           β–Ό                                       β–Ό
    CLIProcessManager                      claude-flow@alpha
           β”‚                                       β”‚
           β–Ό                                       β–Ό
    claude | gemini | codex               npx claude-flow swarm
```

### ν›… κµ¬μ΅°

```typescript
// useAI - λ‹¨μΌ CLI μ‹¤ν–‰ (λ‹¤μ¤‘ Provider)
useAI()
β”β”€β”€ provider: 'claude' | 'gemini' | 'codex' | 'qwen'
β”β”€β”€ model: string
β”β”€β”€ execute(params)
β”β”€β”€ stop()
β””β”€β”€ reset()

// useSwarm - Swarm λ©€ν‹°μ—μ΄μ „νΈ (Claude-Flow μ „μ©)
useSwarm()
β”β”€β”€ strategy: 'development' | 'research' | 'testing'
β”β”€β”€ maxAgents: number
β”β”€β”€ execute(params)
β”β”€β”€ stop()
β””β”€β”€ logs, progress

// useClaude - ν•μ„ νΈν™ λνΌ
useClaude() = useAI({ provider: 'claude' })
```

### κµ¬ν„ λ‹¨κ³„

#### Phase 1: ν›… λ¦¬ν©ν† λ§
1. `useAI` ν›… μƒμ„± - λ‹¤μ¤‘ Provider μ§€μ›
2. `useClaude` β†’ useAI λνΌλ΅ λ³€κ²½ (ν•μ„ νΈν™)
3. `useClaudeFlowExecution` β†’ `useSwarm` λ¦¬λ„¤μ„

#### Phase 2: μ„λ²„ API ν™•μ¥
1. `/api/ai/execute` μ—”λ“ν¬μΈνΈ μƒμ„±
2. CLI Adapterμ `CLIProcessManager` μ—°κ²°
3. Providerλ³„ ν”„λ΅¬ν”„νΈ ν•μ‹ μ²λ¦¬

#### Phase 3: UI μμ •
1. TaskExecutionDialogμ— μ‹¤ν–‰ λ¨λ“ νƒ­ μ¶”κ°€
2. λ‹¨μΌ λ¨λ“: Provider + Model μ„ νƒ
3. Swarm λ¨λ“: Strategy + MaxAgents μ„¤μ •
4. CLI κ°€μ©μ„± μ²΄ν¬ λ° λΉ„ν™μ„±ν™” ν‘μ‹

### μ‹¤ν–‰ λ¨λ“ λΉ„κµ

| κµ¬λ¶„ | λ‹¨μΌ μ‹¤ν–‰ (useAI) | Swarm μ‹¤ν–‰ (useSwarm) |
|------|-------------------|----------------------|
| **μ©λ„** | λ‹¨μΌ νμΌ μμ •, κ°„λ‹¨ν• νƒμ¤ν¬ | λ€κ·λ¨ λ¦¬ν©ν† λ§, λ³µν•© νƒμ¤ν¬ |
| **ν† ν°** | 15-65K (μ €λ ΄) | 50-200K+ (κ³ λΉ„μ©) |
| **μ†λ„** | λΉ λ¦„ (1-5λ¶„) | λλ¦Ό (10-30λ¶„) |
| **Provider** | Claude/Gemini/Codex/Qwen | Claude-Flow μ „μ© |
| **μ—μ΄μ „νΈ** | 1κ° | 1-10κ° |

### UI λ””μμΈ

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ νƒμ¤ν¬ μ‹¤ν–‰                                          β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚                                                      β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”          β”‚
β”‚  β”‚  β΅ λ‹¨μΌ μ‹¤ν–‰     β”‚ β”‚  π Swarm μ‹¤ν–‰   β”‚          β”‚
β”‚  β”‚  β”β”β”β”β”β”β”β”β”β”β”β”β”β”  β”‚ β”‚                  β”‚          β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β” β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”          β”‚
β”‚                                                      β”‚
β”‚  β”€β”€ AI Provider β”€β”€                                  β”‚
β”‚                                                      β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”       β”‚
β”‚  β”‚ π¤– Claude                         [β“]   β”‚       β”‚
β”‚  β”‚    Anthropic Claude Code CLI            β”‚       β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”       β”‚
β”‚                                                      β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”       β”‚
β”‚  β”‚ π’ Gemini                         [ ]   β”‚       β”‚
β”‚  β”‚    Google Gemini CLI (100λ§ ν† ν°)       β”‚       β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”       β”‚
β”‚                                                      β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”       β”‚
β”‚  β”‚ π§  Codex                    [λ―Έμ„¤μΉ]    β”‚       β”‚
β”‚  β”‚    OpenAI Codex CLI                     β”‚       β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”       β”‚
β”‚                                                      β”‚
β”‚  β”€β”€ λ¨λΈ μ„ νƒ (Claude) β”€β”€                           β”‚
β”‚                                                      β”‚
β”‚  β—‹ Haiku   - λΉ λ¥΄κ³  μ €λ ΄ (λ‹¨μ νƒμ¤ν¬)             β”‚
β”‚  β— Sonnet  - κ· ν• μ΅ν μ„±λ¥ (κ¶μ¥)                 β”‚
β”‚  β—‹ Opus    - μµκ³  ν’μ§ (λ³µμ΅ν• νƒμ¤ν¬)             β”‚
β”‚                                                      β”‚
β”‚                    [ μ‹¤ν–‰ μ‹μ‘ ]                     β”‚
β”‚                                                      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### νƒ€μ… μ •μ

```typescript
// src/types/ai.ts

// μ‹¤ν–‰ λ¨λ“
export type ExecutionMode = 'single' | 'swarm'

// AI Provider (λ‹¨μΌ μ‹¤ν–‰μ©)
export type AIProvider = 'claude' | 'gemini' | 'codex' | 'qwen' | 'kilo' | 'opencode'

// Provider μ„¤μ •
export interface AIProviderConfig {
  id: AIProvider
  name: string
  icon: string
  enabled: boolean
  available: boolean  // CLI μ„¤μΉ μ—¬λ¶€
  selectedModel: string
  availableModels: string[]
  order: number
}

// λ‹¨μΌ μ‹¤ν–‰ νλΌλ―Έν„°
export interface AIExecuteParams {
  provider: AIProvider
  model: string
  changeId: string
  taskId: string
  taskTitle: string
  context?: string
}

// Swarm μ‹¤ν–‰ νλΌλ―Έν„°
export interface SwarmExecuteParams {
  strategy: 'development' | 'research' | 'testing'
  maxAgents: number
  changeId: string
  taskId?: string
  mode: 'full' | 'single' | 'analysis'
}
```

## Risks & Mitigations

| λ¦¬μ¤ν¬ | μ™„ν™” λ°©μ• |
|--------|----------|
| CLI λ―Έμ„¤μΉ μ‹ μ¤λ¥ | μ‹¤ν–‰ μ „ `which` μ²΄ν¬, λΉ„ν™μ„± ν‘μ‹ |
| Providerλ³„ μ¶λ ¥ ν•μ‹ μ°¨μ΄ | κ³µν†µ νμ„ μΈν„°νμ΄μ¤ μ •μ |
| API ν‚¤ λ„λ½ | ν™κ²½λ³€μ μ²΄ν¬, μ„¤μ • μ•λ‚΄ ν‘μ‹ |
| κΈ°μ΅΄ useClaude νΈν™μ„± | useClaudeλ” useAI wrapperλ΅ μ μ§€ |
| μ‹¤ν–‰ λ¨λ“ νΌλ€ | λ…ν™•ν• νƒ­ UI + λΉ„μ© μ•λ‚΄ ν‘μ‹ |
| Swarm λΉ„μ© μμΈ΅ μ–΄λ ¤μ›€ | μμƒ ν† ν° λ²”μ„ ν‘μ‹ |

## Dependencies

### κΈ°μ΅΄ μ½”λ“ ν™μ©
- `server/cli-adapter/types.ts` - CLIProfile, CLIType μ •μ
- `server/cli-adapter/process-manager.ts` - CLIProcessManager
- `server/claude-flow/` - Swarm μ‹¤ν–‰ λ΅μ§
- `.zyflow/cli-settings.json` - Provider μ„¤μ •
- `src/hooks/useClaude.ts` - κΈ°μ΅΄ μ‹¤ν–‰ λ΅μ§ μ°Έκ³ 
- `src/hooks/useClaudeFlowExecution.ts` - Swarm λ΅μ§

### μƒλ΅ ν•„μ”ν• κ²ƒ
- Providerλ³„ CLI μ„¤μΉ (μ„ νƒμ )
  - `npm install -g @anthropic/claude-code`
  - `npm install -g @google/gemini-cli`
  - `npm install -g @openai/codex`

## Success Criteria

- [ ] μ‹¤ν–‰ λ¨λ“ μ„ νƒ UI (λ‹¨μΌ/Swarm νƒ­) λ™μ‘
- [ ] Claude μ™Έ μµμ† 1κ° Provider (Gemini) λ™μ‘ ν™•μΈ
- [ ] TaskExecutionDialogμ—μ„ Provider μ„ νƒ κ°€λ¥
- [ ] Providerλ³„ λ¨λΈ μ„ νƒ κ°€λ¥
- [ ] CLI λ―Έμ„¤μΉ μ‹ λΉ„ν™μ„±ν™” ν‘μ‹
- [ ] cli-settings.json κΈ°λ° μ„¤μ • λ°μ
- [ ] κΈ°μ΅΄ useClaude μ½”λ“ ν•μ„ νΈν™
- [ ] useSwarmμΌλ΅ λ¦¬λ„¤μ„ μ™„λ£
- [ ] μ‹¤ν–‰ λ΅κ·Έμ— Provider/Model/Mode μ •λ³΄ ν‘μ‹
